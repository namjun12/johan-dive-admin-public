<!DOCTYPE html>
<html lang="ko">
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=0"
  />

  <title>요한다이브 - 관리자</title>
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
  <link rel="stylesheet" type="text/css" href="./css/common.css" />
  <link rel="stylesheet" type="text/css" href="./css/style.css" />
  <link rel="stylesheet" type="text/css" href="/src/output.css" />
  <body>
    <div id="wrap" class="schedule-page-container mb-20">
      <div>
        <header id="header"></header>

        <div class="popup-page-container">
          <div class="title_type01">
            <div class="ri_wrap">
              <div class="control-whole-wrap">
                <div class="product-search-wrap">
                  <div class="data-control-wrap">
                    <a class="selected-data-apply flex-center" href="#"
                      >일정 등록</a
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 캘린더 영역 -->
          <div class="mt-10">
            <div
              class="calendar-header flex items-center justify-center gap-4 xl:mb-14 mb-10"
            >
              <button class="btn-prev-month btn-control-month">
                <i translate="no"></i>
              </button>
              <strong id="calendar-title" class="xl:text-[40px] text-[20px]"
                >title</strong
              >
              <button class="btn-next-month btn-control-month">
                <i translate="no"></i>
              </button>
            </div>
            <div
              class="color-container flex lg:flex-row flex-col lg:items-center xl:gap-6 gap-4 xl:mb-6 mb-4"
            >
              <div class="flex items-center gap-2">
                <ul class="flex items-center gap-1">
                  <li class="color-item bg-[#b431eb]"></li>
                  <li class="color-item bg-[#f541cb]"></li>
                  <li class="color-item bg-[#ffc401]"></li>
                  <li class="color-item bg-[#00a8ff]"></li>
                  <li class="color-item bg-[#3168e8]"></li>
                  <li class="color-item bg-[#01c415]"></li>
                  <li class="color-item bg-[#4a8b33]"></li>
                </ul>
                <p class="xl:text-[17px] text-[13px] font-medium">
                  디럭스룸 패키지
                </p>
              </div>
              <div class="flex items-center gap-2">
                <ul>
                  <li class="color-item bg-black"></li>
                </ul>
                <p class="xl:text-[17px] text-[13px] font-medium">
                  다이빙 패키지
                </p>
              </div>
            </div>
          </div>
          <div id="calendar"></div>
          <div id="eventDetail"></div>
        </div>
      </div>

      <!-- 달력 모달 구조 -->
      <div id="event-modal">
        <div class="modal-content flex flex-col">
          <button id="closeModal" class="close-btn ml-auto">
            <i class="text-[32px]" translate="no"></i>
          </button>
          <div>
            <div>
              <strong
                id="modal-title"
                class="w-full text-center xl:text-[20px] text-[16px]"
              ></strong>
              <div
                class="flex items-center justify-center xl:text-[20px] text-[16px] mt-2"
              >
                <strong
                  class="leading-1 modal-user border-r-1 border-gray-1 xl:pr-4 pr-2 xl:mr-4 mr-2"
                ></strong>
                <strong class="modal-count"></strong>
              </div>
            </div>
            <div
              class="text-center border-t-1 border-gray-2 xl:pt-6 pt-4 xl:mt-6 mt-4"
            >
              <div
                class="period-of-use xl:text-[18px] text-[14px] font-medium"
              ></div>
              <p
                class="description xl:text-[17px] text-[14px] font-light xl:mt-6 mt-4"
              ></p>
            </div>

            <div class="grid grid-cols-2 gap-4 mt-8">
              <button class="bg-[#656565] text-white py-3">삭제</button>
              <button class="bg-[#01a9ff] text-white py-3">수정</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>

  <!-- FullCalendar 스크립트 -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const calendarEl = document.getElementById("calendar");
      const calendarTitle = document.getElementById("calendar-title");
      const btnPrevMonth = document.querySelector(".btn-prev-month");
      const btnNextMonth = document.querySelector(".btn-next-month");

      const modal = document.getElementById("event-modal");
      const btnCloseModal = document.getElementById("closeModal");
      const modalTitleEl = document.getElementById("modal-title");
      const modalUserEl = document.querySelector(".modal-user");
      const modalCountEl = document.querySelector(".modal-count");
      const modalPeriodOfUseEl = document.querySelector(".period-of-use");
      const modalDescriptionEl = document.querySelector(".description");

      // 모달 닫기 로직
      btnCloseModal.addEventListener("click", () => {
        modal.style.display = "none";
      });
      // 모달 바깥 클릭 시 닫기
      modal.addEventListener("click", (e) => {
        if (e.target === modal) modal.style.display = "none";
      });

      // 캘린더 이벤트 배열
      const calendarEvents = [
        {
          id: "1",
          title: "D1 디럭스룸 패키지",
          start: "2025-08-09",
          end: "2025-08-16",
          customType: "internal", // 마우스 호버 효과
          extendedProps: {
            user: "홍길동",
            count: 2,
            periodOfUse: "2025-06-09(종일) - 2025-06-16(종일)",
            description: "설명",
            isStartInAM: false, // 오전에 시작하는 지 여부
            isEndInAM: false, // 오전에 끝나는 지 여부
            color: "type-1", // 배경색(type-1 ~ type-8)
          },
        },
        {
          id: "2",
          title: "D2 디럭스룸 패키지 ㄴㅇㄴㅇㄴㅇㄴㅇㄴㅇㄴㅇㄴㅇ",
          start: "2025-08-17",
          end: "2025-08-17",
          customType: "internal", // 마우스 호버 효과
          extendedProps: {
            user: "홍길동",
            count: 2,
            periodOfUse: "2025-07-17(오전) - 2025-07-17(종일)",
            description: "설명",
            isStartInAM: true, // 오전에 시작하는 지 여부
            isEndInAM: false, // 오전에 끝나는 지 여부
            color: "type-2", // 배경색(type-1 ~ type-8)
          },
        },
      ];

      // 1일을 더해주는 로직 적용
      calendarEvents.forEach((ev) => {
        const d = new Date(ev.end);
        ev.end = new Date(d.getTime() + 24 * 60 * 60 * 1000);
        ev.allDay = true;
      });

      // 캘린더 초기화
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        locale: "ko",
        events: calendarEvents,
        // 이벤트 클릭 콜백
        eventClick: function (info) {
          const ev = info.event;
          const props = ev.extendedProps;

          // ✅ 이름 첫글자와 마지막 글자 제외하고 * 처리
          let maskedUser = ""; // * 처리된 이름

          if (props.user.length <= 2) {
            maskedUser = props.user; // 글자 수가 2 이하인 경우 그대로 출력
          } else {
            const firstChar = props.user[0];
            const lastChar = props.user[props.user.length - 1];
            const middle = "*".repeat(props.user.length - 2);
            maskedUser = firstChar + middle + lastChar;
          }

          // 모달에 데이터 채우기
          modalTitleEl.textContent = ev.title;
          modalUserEl.textContent = maskedUser;
          modalCountEl.textContent = `${props.count}인`;
          modalPeriodOfUseEl.textContent = props.periodOfUse;
          modalDescriptionEl.textContent = props.description;

          // 모달 표시
          modal.style.display = "flex";
        },
        datesSet: function () {
          const currentDate = calendar.getDate();
          const year = currentDate.getFullYear();
          const month = (currentDate.getMonth() + 1)
            .toString()
            .padStart(2, "0");

          calendarTitle.textContent = `${year}년 ${month}월`;
        },
        //'일' 삭제
        dayCellContent: function (info) {
          var number = document.createElement("a");
          number.classList.add("fc-daygrid-day-number");
          number.innerHTML = info.dayNumberText.replace("일", "");
          if (info.view.type === "dayGridMonth") {
            return {
              html: number.outerHTML,
            };
          }
          return {
            domNodes: [],
          };
        },
        // 이벤트 클래스명 설정
        eventClassNames: function (info) {
          const props = info.event.extendedProps;
          let classes = [];

          // 배경색을 지정할 클래스 추가
          classes.push(props.color);

          // 시작 시간에 따른 클래스 추가
          if (props.isStartInAM) {
            classes.push("event-start-am");
          }

          // 종료 시간에 따른 클래스 추가
          if (props.isEndInAM) {
            classes.push("event-end-am");
          }

          return classes;
        },

        // 마우스 호버 효과
        eventMouseEnter: function (info) {
          const isInternal =
            info.event.extendedProps?.customType === "internal";
          if (!isInternal) return;

          const el = info.el;
          const rect = el.getBoundingClientRect();
          const scrollTop =
            window.pageYOffset || document.documentElement.scrollTop;
          const scrollLeft =
            window.pageXOffset || document.documentElement.scrollLeft;

          const detailBox = document.getElementById("eventDetail");
          detailBox.textContent = info.event.title;
          detailBox.style.top = `${rect.top + scrollTop + rect.height + 8}px`;
          detailBox.style.left = `${rect.left + scrollLeft}px`;
          detailBox.style.display = "block";
        },

        eventMouseLeave: function () {
          const detailBox = document.getElementById("eventDetail");
          detailBox.style.display = "none";
        },
      });

      calendar.render();

      // 이전 달, 다음 달 조작
      btnPrevMonth.addEventListener("click", () => {
        calendar.prev();
      });
      btnNextMonth.addEventListener("click", () => {
        calendar.next();
      });
    });
  </script>

  <script src="/js/jquery.js"></script>
  <script src="/js/script.js"></script>
</html>
